TLS 1.2 握手流程（经典流程，适合理解细节）

```lua
客户端（浏览器）                         服务器
     |                                     |
     | -------- ClientHello -------------> |  🧊我支持这些加密算法，这是我随机数r1
     |                                     |
     | <------- ServerHello -------------- |  🧊我选用算法，这是我随机数r2
     |              + 证书（含公钥）           📜这是我证书（含公钥、公信CA签名）
     |                                     |
     | <-----（可选）CertificateRequest -- |  🤵（可要求客户端提供证书）
     |                                     |
     | -------- Certificate（可选） -----> |  📜客户端提供身份（双向认证时）
     |                                     |
     | ------- ClientKeyExchange --------> |  🧬生成对称密钥，发给服务器（用公钥加密）
     |                                     |
     | ------- ChangeCipherSpec --------> |  ✅我准备好用新密钥加密了
     | ------- Finished（加密） ---------> |
     |                                     |
     | <------ ChangeCipherSpec ----------|  ✅我也准备好
     | <------ Finished（加密） -----------|
     |                                     |
     |------ 开始安全通信（用对称密钥） ----→ 💬
```

---

你现在已经把 HTTPS 的两条腿全跑通了：

- RSA → 握手阶段传对称密钥
- AES → 后续通信真正加密

---

HTTPS 的本质就两步大法：

🔐 第一步：非对称加密阶段 → 搞身份 + 建立信任 + 交换对称密钥

- 浏览器拿到服务器的证书（含公钥），验证其合法性（是否被权威 CA 签过名）
- 验证通过后，用服务器公钥加密生成的对称密钥，传给服务器
- 服务器用私钥解密，拿到这个对称密钥
- 👉 这一步叫：身份认证 + 密钥协商
- 👉 用的是：非对称加密（RSA/ECDHE）

🔒 第二步：对称加密阶段 → 真正开始干活，安全传输数据
双方都拿到了同一个对称密钥

- 后续所有 HTTP 内容（Headers、Body）都用它加密传输
- 👉 这一步叫：数据加密传输（安全通信）
- 👉 用的是：对称加密（如 AES、ChaCha20）

